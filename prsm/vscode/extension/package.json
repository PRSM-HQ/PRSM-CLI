{
  "name": "prsm-vscode",
  "displayName": "PRSM Agent Orchestrator",
  "description": "Multi-agent orchestration with real-time agent tree visualization",
  "version": "0.1.1",
  "publisher": "prsm",
  "engines": {
    "vscode": "^1.85.0"
  },
  "categories": [
    "Other"
  ],
  "activationEvents": [
    "onView:prsmAgentTree",
    "onStartupFinished"
  ],
  "main": "./out/extension.js",
  "configurationDefaults": {
    "workbench.hover.delay": 150
  },
  "contributes": {
    "viewsContainers": {
      "activitybar": [
        {
          "id": "prsm",
          "title": "PRSM",
          "icon": "media/icons/prsm.svg"
        }
      ]
    },
    "views": {
      "prsm": [
        {
          "id": "prsmAgentTree",
          "name": "Agent Tree"
        },
        {
          "id": "prsmFileChanges",
          "name": "File Changes"
        },
        {
          "id": "prsmSnapshots",
          "name": "Snapshots"
        }
      ]
    },
    "commands": [
      {
        "command": "prsm.newSession",
        "title": "PRSM: New Session",
        "icon": "$(add)"
      },
      {
        "command": "prsm.runPrompt",
        "title": "PRSM: Run Prompt",
        "icon": "$(play)"
      },
      {
        "command": "prsm.forkSession",
        "title": "PRSM: Fork Session",
        "icon": "$(repo-forked)"
      },
      {
        "command": "prsm.removeSession",
        "title": "PRSM: Remove Session",
        "icon": "$(trash)"
      },
      {
        "command": "prsm.showAgentConversation",
        "title": "PRSM: Show Agent Conversation"
      },
      {
        "command": "prsm.showOrchestratorConversation",
        "title": "PRSM: Show Orchestrator Conversation"
      },
      {
        "command": "prsm.killAgent",
        "title": "PRSM: Kill Agent",
        "icon": "$(close)"
      },
      {
        "command": "prsm.stopOrchestration",
        "title": "PRSM: Stop Orchestration",
        "icon": "$(debug-stop)"
      },
      {
        "command": "prsm.refreshTree",
        "title": "PRSM: Refresh Tree",
        "icon": "$(refresh)"
      },
      {
        "command": "prsm.openSettings",
        "title": "PRSM: Open Settings",
        "icon": "$(gear)"
      },
      {
        "command": "prsm.setupWorkspace",
        "title": "PRSM: Setup Workspace"
      },
      {
        "command": "prsm.addExpert",
        "title": "PRSM: Add Expert Profile"
      },
      {
        "command": "prsm.removeExpert",
        "title": "PRSM: Remove Expert Profile"
      },
      {
        "command": "prsm.importExpertsFromYaml",
        "title": "PRSM: Import Experts from YAML"
      },
      {
        "command": "prsm.acceptChange",
        "title": "PRSM: Accept Change",
        "icon": "$(check)"
      },
      {
        "command": "prsm.rejectChange",
        "title": "PRSM: Reject Change",
        "icon": "$(close)"
      },
      {
        "command": "prsm.acceptAllFileChanges",
        "title": "PRSM: Accept All Changes in File",
        "icon": "$(check-all)"
      },
      {
        "command": "prsm.rejectAllFileChanges",
        "title": "PRSM: Reject All Changes in File",
        "icon": "$(close-all)"
      },
      {
        "command": "prsm.acceptAllSessionChanges",
        "title": "PRSM: Accept All Changes in Session",
        "icon": "$(check-all)"
      },
      {
        "command": "prsm.rejectAllSessionChanges",
        "title": "PRSM: Reject All Changes in Session",
        "icon": "$(close-all)"
      },
      {
        "command": "prsm.acceptAllChanges",
        "title": "PRSM: Accept All Agent Changes"
      },
      {
        "command": "prsm.rejectAllChanges",
        "title": "PRSM: Reject All Agent Changes"
      },
      {
        "command": "prsm.goToAgent",
        "title": "PRSM: Go to Agent",
        "icon": "$(arrow-right)"
      },
      {
        "command": "prsm.createSnapshot",
        "title": "PRSM: Create Snapshot",
        "icon": "$(save)"
      },
      {
        "command": "prsm.restoreSnapshot",
        "title": "PRSM: Restore Snapshot",
        "icon": "$(history)"
      },
      {
        "command": "prsm.forkSnapshot",
        "title": "PRSM: Fork Snapshot",
        "icon": "$(git-branch)"
      },
      {
        "command": "prsm.deleteSnapshot",
        "title": "PRSM: Delete Snapshot",
        "icon": "$(trash)"
      },
      {
        "command": "prsm.saveSession",
        "title": "PRSM: Save Session"
      },
      {
        "command": "prsm.renameSession",
        "title": "PRSM: Rename Session",
        "icon": "$(edit)"
      },
      {
        "command": "prsm.deleteSelected",
        "title": "PRSM: Delete Selected",
        "icon": "$(trash)"
      },
      {
        "command": "prsm.showAgentContext",
        "title": "PRSM: View Agent Context"
      },
      {
        "command": "prsm.showAgentContextFromTree",
        "title": "PRSM: View Agent Context"
      },
      {
        "command": "prsm.worktree.list",
        "title": "PRSM: List Worktrees",
        "icon": "$(list-tree)"
      },
      {
        "command": "prsm.worktree.create",
        "title": "PRSM: Create Worktree",
        "icon": "$(add)"
      },
      {
        "command": "prsm.worktree.remove",
        "title": "PRSM: Remove Worktree",
        "icon": "$(trash)"
      },
      {
        "command": "prsm.worktree.switch",
        "title": "PRSM: Switch Worktree",
        "icon": "$(arrow-swap)"
      },
      {
        "command": "prsm.worktree.toggleFilter",
        "title": "PRSM: Toggle Worktree Session Filter",
        "icon": "$(filter)"
      },
      {
        "command": "prsm.viewFileDiff",
        "title": "PRSM: View File Diff",
        "icon": "$(diff)"
      },
      {
        "command": "prsm.nextChange",
        "title": "PRSM: Next Change",
        "icon": "$(arrow-down)"
      },
      {
        "command": "prsm.prevChange",
        "title": "PRSM: Previous Change",
        "icon": "$(arrow-up)"
      },
      {
        "command": "prsm.acceptCurrentChange",
        "title": "PRSM: Accept Change at Cursor"
      },
      {
        "command": "prsm.rejectCurrentChange",
        "title": "PRSM: Reject Change at Cursor"
      },
      {
        "command": "prsm.inspectChange",
        "title": "PRSM: Inspect Change",
        "icon": "$(search)"
      },
      {
        "command": "prsm.inspectCurrentChange",
        "title": "PRSM: Inspect Change at Cursor"
      },
      {
        "command": "prsm.searchTree",
        "title": "PRSM: Search Agent Tree",
        "icon": "$(search)"
      },
      {
        "command": "prsm.clearTreeSearch",
        "title": "PRSM: Clear Agent Tree Search",
        "icon": "$(close)"
      }
    ],
    "keybindings": [
      {
        "command": "prsm.deleteSelected",
        "key": "delete",
        "when": "focusedView == prsmAgentTree"
      },
      {
        "command": "prsm.nextChange",
        "key": "ctrl+]",
        "mac": "cmd+]",
        "when": "editorTextFocus && prsm.fileHasPendingChanges"
      },
      {
        "command": "prsm.prevChange",
        "key": "ctrl+[",
        "mac": "cmd+[",
        "when": "editorTextFocus && prsm.fileHasPendingChanges"
      },
      {
        "command": "prsm.acceptCurrentChange",
        "key": "ctrl+shift+a",
        "mac": "cmd+shift+a",
        "when": "editorTextFocus && prsm.fileHasPendingChanges"
      },
      {
        "command": "prsm.rejectCurrentChange",
        "key": "ctrl+shift+r",
        "mac": "cmd+shift+r",
        "when": "editorTextFocus && prsm.fileHasPendingChanges"
      },
      {
        "command": "prsm.inspectCurrentChange",
        "key": "ctrl+shift+i",
        "mac": "cmd+shift+i",
        "when": "editorTextFocus && prsm.fileHasPendingChanges"
      }
    ],
    "menus": {
      "view/title": [
        {
          "command": "prsm.newSession",
          "when": "view == prsmAgentTree",
          "group": "navigation@1"
        },
        {
          "command": "prsm.searchTree",
          "when": "view == prsmAgentTree",
          "group": "navigation@2"
        },
        {
          "command": "prsm.clearTreeSearch",
          "when": "view == prsmAgentTree && prsm.treeSearchActive",
          "group": "navigation@3"
        },
        {
          "command": "prsm.worktree.toggleFilter",
          "when": "view == prsmAgentTree && prsm.isGitRepo",
          "group": "navigation@4"
        },
        {
          "command": "prsm.refreshTree",
          "when": "view == prsmAgentTree",
          "group": "navigation@5"
        },
        {
          "command": "prsm.openSettings",
          "when": "view == prsmAgentTree",
          "group": "navigation@6"
        },
        {
          "command": "prsm.importSessionArchive",
          "when": "view == prsmAgentTree",
          "group": "2_archive@1"
        },
        {
          "command": "prsm.exportSessions",
          "when": "view == prsmAgentTree",
          "group": "2_archive@2"
        },
        {
          "command": "prsm.acceptAllChanges",
          "when": "view == prsmFileChanges",
          "group": "navigation@1"
        },
        {
          "command": "prsm.createSnapshot",
          "when": "view == prsmSnapshots",
          "group": "navigation@1"
        }
      ],
      "view/item/context": [
        {
          "command": "prsm.runPrompt",
          "when": "viewItem == prsmSession",
          "group": "1_actions@1"
        },
        {
          "command": "prsm.forkSession",
          "when": "viewItem == prsmSession",
          "group": "1_actions@2"
        },
        {
          "command": "prsm.stopOrchestration",
          "when": "viewItem == prsmSession",
          "group": "2_manage@2"
        },
        {
          "command": "prsm.renameSession",
          "when": "viewItem == prsmSession",
          "group": "2_manage@1"
        },
        {
          "command": "prsm.deleteSelected",
          "when": "viewItem == prsmSession",
          "group": "2_manage@3"
        },
        {
          "command": "prsm.deleteSelected",
          "when": "viewItem == prsmAgent",
          "group": "2_manage@1"
        },
        {
          "command": "prsm.acceptAllSessionChanges",
          "when": "viewItem == prsmChangedSession",
          "group": "inline@1"
        },
        {
          "command": "prsm.rejectAllSessionChanges",
          "when": "viewItem == prsmChangedSession",
          "group": "inline@2"
        },
        {
          "command": "prsm.acceptAllFileChanges",
          "when": "viewItem == prsmChangedFile",
          "group": "inline@1"
        },
        {
          "command": "prsm.rejectAllFileChanges",
          "when": "viewItem == prsmChangedFile",
          "group": "inline@2"
        },
        {
          "command": "prsm.viewFileDiff",
          "when": "viewItem == prsmChangedFile",
          "group": "inline@3"
        },
        {
          "command": "prsm.acceptChange",
          "when": "viewItem == prsmFileChange",
          "group": "inline@1"
        },
        {
          "command": "prsm.rejectChange",
          "when": "viewItem == prsmFileChange",
          "group": "inline@2"
        },
        {
          "command": "prsm.goToAgent",
          "when": "viewItem == prsmFileChange",
          "group": "inline@3"
        },
        {
          "command": "prsm.inspectChange",
          "when": "viewItem == prsmFileChange",
          "group": "inline@4"
        },
        {
          "command": "prsm.showAgentContext",
          "when": "viewItem == prsmFileChange",
          "group": "1_context@1"
        },
        {
          "command": "prsm.viewFileDiff",
          "when": "viewItem == prsmFileChange",
          "group": "1_context@2"
        },
        {
          "command": "prsm.showAgentContextFromTree",
          "when": "viewItem == prsmChangedFile",
          "group": "1_context@1"
        },
        {
          "command": "prsm.forkSnapshot",
          "when": "viewItem == prsmSnapshot",
          "group": "inline@1"
        },
        {
          "command": "prsm.restoreSnapshot",
          "when": "viewItem == prsmSnapshot",
          "group": "inline@2"
        },
        {
          "command": "prsm.deleteSnapshot",
          "when": "viewItem == prsmSnapshot",
          "group": "inline@3"
        }
      ],
      "editor/title": [
        {
          "command": "prsm.acceptAllFileChanges",
          "when": "prsm.fileHasPendingChanges",
          "group": "navigation@1"
        },
        {
          "command": "prsm.rejectAllFileChanges",
          "when": "prsm.fileHasPendingChanges",
          "group": "navigation@2"
        },
        {
          "command": "prsm.viewFileDiff",
          "when": "prsm.fileHasPendingChanges",
          "group": "navigation@3"
        },
        {
          "command": "prsm.inspectCurrentChange",
          "when": "prsm.fileHasPendingChanges",
          "group": "navigation@4"
        }
      ]
    },
    "configuration": {
      "title": "PRSM",
      "properties": {
        "prsm.executablePath": {
          "type": "string",
          "default": "prsm",
          "description": "Path to the prsm CLI executable"
        },
        "prsm.autoStart": {
          "type": "boolean",
          "default": true,
          "description": "Automatically start the PRSM server on extension activation"
        },
        "prsm.autoSetupWorkspace": {
          "type": "boolean",
          "default": true,
          "description": "Prompt to set up .mcp.json and .claude/ when opening a new workspace"
        },
        "prsm.yamlConfigPath": {
          "type": "string",
          "default": "",
          "description": "Path to a YAML config file. When set, overrides all individual settings below."
        },
        "prsm.engine.maxAgentDepth": {
          "type": "integer",
          "default": 5,
          "minimum": 1,
          "maximum": 20,
          "description": "Maximum nested agent depth"
        },
        "prsm.engine.maxConcurrentAgents": {
          "type": "integer",
          "default": 10,
          "minimum": 1,
          "maximum": 100,
          "description": "Maximum concurrent agents"
        },
        "prsm.engine.agentTimeoutSeconds": {
          "type": "number",
          "default": 7200,
          "minimum": 0,
          "description": "Per-agent reasoning timeout in seconds (0 disables timeout)"
        },
        "prsm.engine.toolCallTimeoutSeconds": {
          "type": "number",
          "default": 7200,
          "minimum": 0,
          "description": "Per-tool-call timeout in seconds (0 disables timeout)"
        },
        "prsm.engine.userQuestionTimeoutSeconds": {
          "type": "number",
          "default": 0,
          "minimum": 0,
          "description": "Timeout in seconds for user-question responses (0 disables timeout)"
        },
        "prsm.engine.sessionInactivityMinutes": {
          "type": "number",
          "default": 15,
          "minimum": 0,
          "description": "Minutes of inactivity before a session is automatically unloaded. Set 0 to disable. (Not recomended)"
        },
        "prsm.thinkingVerbs.enableNsfw": {
          "type": "boolean",
          "default": true,
          "description": "Include NSFW thinking verbs in the webview thinking indicator."
        },
        "prsm.thinkingVerbs.custom": {
          "type": "array",
          "default": [],
          "description": "Custom thinking verbs appended to the indicator rotation.",
          "items": {
            "type": "string"
          }
        },
        "prsm.ui.inputMarkdownPreviewEnabled": {
          "type": "boolean",
          "default": true,
          "description": "Show a live markdown preview below the prompt input in PRSM webviews."
        },
        "prsm.security.commandWhitelist": {
          "type": "array",
          "default": [],
          "description": "Regex patterns for bash commands that should be auto-allowed (stored in .prism/command_whitelist.txt).",
          "items": {
            "type": "string"
          }
        },
        "prsm.security.commandBlacklist": {
          "type": "array",
          "default": [],
          "description": "Regex patterns for bash commands that should be always denied (stored in .prism/command_blacklist.txt).",
          "items": {
            "type": "string"
          }
        },
        "prsm.providers": {
          "type": "object",
          "default": {
            "claude": {
              "type": "claude"
            },
            "codex": {
              "type": "codex",
              "command": "codex"
            }
          },
          "description": "AI provider configurations. Each key is a provider ID, value has 'type' and optional settings.",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "description": "Provider type (claude, codex)"
              },
              "command": {
                "type": "string",
                "description": "CLI command for the provider (for codex type)"
              }
            }
          }
        },
        "prsm.models": {
          "type": "object",
          "default": {
            "opus-4-6": {
              "provider": "claude",
              "model_id": "claude-opus-4-6"
            },
            "sonnet-4-5": {
              "provider": "claude",
              "model_id": "claude-sonnet-4-5-20250929"
            },
            "gpt-5-3-low": {
              "provider": "codex",
              "model_id": "gpt-5.3-codex",
              "reasoning_effort": "low"
            },
            "gpt-5-3-spark": {
              "provider": "codex",
              "model_id": "gpt-5.3-spark"
            },
            "gpt-5-3-medium": {
              "provider": "codex",
              "model_id": "gpt-5.3-codex",
              "reasoning_effort": "medium"
            },
            "gpt-5-3-high": {
              "provider": "codex",
              "model_id": "gpt-5.3-codex",
              "reasoning_effort": "high"
            }
          },
          "description": "Model alias definitions. Each key is an alias, value has 'provider', 'model_id', and optional 'reasoning_effort' for Codex/GPT models.",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "provider": {
                "type": "string",
                "description": "Provider ID (must match a key in prsm.providers)"
              },
              "model_id": {
                "type": "string",
                "description": "Model identifier for the provider"
              },
              "reasoning_effort": {
                "type": "string",
                "enum": [
                  "low",
                  "medium",
                  "high"
                ],
                "description": "Optional Codex/GPT reasoning effort level."
              }
            },
            "required": [
              "provider",
              "model_id"
            ]
          }
        },
        "prsm.defaults.model": {
          "type": "string",
          "default": "opus-4-6",
          "description": "Default model alias for new agents"
        },
        "prsm.defaults.peerModel": {
          "type": "string",
          "default": "gpt-5-3-medium",
          "description": "Default model alias for peer consultations (second opinion)"
        },
        "prsm.experts": {
          "type": "object",
          "default": {},
          "description": "Expert profile definitions. Each key is an expert ID.",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Display name for the expert"
              },
              "description": {
                "type": "string",
                "description": "What this expert specializes in"
              },
              "system_prompt": {
                "type": "string",
                "description": "System prompt giving the expert its domain knowledge"
              },
              "tools": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "MCP tools available to this expert (e.g., Read, Write, Edit, Glob, Grep, Bash)"
              },
              "model": {
                "type": "string",
                "description": "Model alias for this expert"
              },
              "permission_mode": {
                "type": "string",
                "enum": [
                  "full",
                  "acceptEdits",
                  "plan"
                ],
                "description": "Permission level: full (all tools), acceptEdits (auto-allow reads), plan (read-only)"
              },
              "cwd": {
                "type": "string",
                "description": "Working directory for this expert (relative to workspace root)"
              }
            },
            "required": [
              "name",
              "description",
              "system_prompt"
            ]
          }
        }
      }
    }
  },
  "scripts": {
    "vscode:prepublish": "npm run build",
    "build": "node esbuild.js --production",
    "watch": "node esbuild.js --watch",
    "lint": "eslint src --ext ts"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "@types/vscode": "^1.85.0",
    "@vscode/vsce": "^3.7.1",
    "esbuild": "^0.21.0",
    "typescript": "^5.4.0"
  },
  "dependencies": {
    "eventsource": "^2.0.2",
    "yaml": "^2.8.2"
  }
}
